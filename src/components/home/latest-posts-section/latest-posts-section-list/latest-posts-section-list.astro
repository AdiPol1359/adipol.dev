---
import { PostCard } from '@/components/blocks';

import { LATEST_POSTS_LIMIT } from '../latest-posts-section.constants';
import LatestPostsSectionListEmptySpaceCard from './latest-posts-section-list-empty-space-card.astro';
import { LATEST_POSTS_SECTION_LIST_ID } from './latest-posts-section-list.constants';

import type { Post } from '@/types/post';

interface Props {
	readonly posts: Post[];
}

const latestPosts = Astro.props.posts.slice(0, LATEST_POSTS_LIMIT);
const emptySpaces = Array.from({
	length: LATEST_POSTS_LIMIT - latestPosts.length,
});
---

<ol
	id={LATEST_POSTS_SECTION_LIST_ID}
	class="grid grid-cols-1 gap-4 opacity-0 tablet:grid-cols-2 laptop:grid-cols-3"
>
	{
		latestPosts.map(post => (
			<li>
				<PostCard
					post={post}
					thumbnailProps={{
						sizes: '(min-width: 1024px) 382px, (min-width: 640px) 50vw, 100vw',
					}}
				/>
			</li>
		))
	}
	{
		emptySpaces.map(() => (
			<li class="hidden tablet:nth-2:block laptop:nth-3:block">
				<LatestPostsSectionListEmptySpaceCard />
			</li>
		))
	}
</ol>

<script>
	import { animate, createFadeInAnimation, inView } from '@/lib/animations';

	import { LATEST_POSTS_SECTION_LIST_ID } from './latest-posts-section-list.constants';

	inView(
		`#${LATEST_POSTS_SECTION_LIST_ID}`,
		element => animate(...createFadeInAnimation(element, { duration: 1 })),
		{ margin: -180 },
	);
</script>
